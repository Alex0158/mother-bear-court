# ÁÜäÂ™ΩÂ™ΩÊ≥ïÂ∫≠ - ÈñãÁôºÁí∞Â¢ÉÈÖçÁΩÆË©≥ÊÉÖ

## üì¶ ÂâçÁ´ØÈñãÁôºÁí∞Â¢É

### package.json
```json
{
  "name": "mother-bear-court-frontend",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "format": "prettier --write \"src/**/*.{ts,tsx,json,css}\""
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "antd": "^5.12.0",
    "zustand": "^4.4.7",
    "axios": "^1.6.2",
    "dayjs": "^1.11.10"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@typescript-eslint/eslint-plugin": "^6.14.0",
    "@typescript-eslint/parser": "^6.14.0",
    "eslint": "^8.55.0",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.5",
    "prettier": "^3.1.0",
    "typescript": "^5.2.2",
    "vite": "^5.0.8"
  }
}
```

### ESLintÈÖçÁΩÆ (.eslintrc.json)
```json
{
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:react-hooks/recommended"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2020,
    "sourceType": "module",
    "ecmaFeatures": {
      "jsx": true
    }
  },
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/no-explicit-any": "warn",
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn"
  }
}
```

### PrettierÈÖçÁΩÆ (.prettierrc.json)
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false
}
```

---

## üì¶ ÂæåÁ´ØÈñãÁôºÁí∞Â¢É

### package.json
```json
{
  "name": "mother-bear-court-backend",
  "version": "1.0.0",
  "scripts": {
    "dev": "nodemon src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js",
    "test": "jest",
    "lint": "eslint . --ext .ts",
    "format": "prettier --write \"src/**/*.ts\""
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "bcrypt": "^5.1.1",
    "jsonwebtoken": "^9.0.2",
    "pg": "^8.11.3",
    "openai": "^4.20.0",
    "nodemailer": "^6.9.7",
    "sharp": "^0.32.6",
    "multer": "^1.4.5-lts.1",
    "node-cron": "^3.0.3"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/cors": "^2.8.17",
    "@types/bcrypt": "^5.0.2",
    "@types/jsonwebtoken": "^9.0.5",
    "@types/node": "^20.10.5",
    "@types/nodemailer": "^6.4.14",
    "@types/multer": "^1.4.11",
    "@types/node-cron": "^3.0.11",
    "typescript": "^5.3.3",
    "ts-node": "^10.9.2",
    "nodemon": "^3.0.2",
    "eslint": "^8.55.0",
    "prettier": "^3.1.0",
    "jest": "^29.7.0"
  }
}
```

---

## üîß Áí∞Â¢ÉËÆäÈáèÈÖçÁΩÆ (.env)

```env
# ÊúçÂãôÂô®ÈÖçÁΩÆ
PORT=3000
NODE_ENV=development

# Êï∏ÊìöÂ∫´ÈÖçÁΩÆ
DATABASE_URL=postgresql://user:password@localhost:5432/mother_bear_court
# Êàñ SQLiteÔºàÈñãÁôºÁí∞Â¢ÉÔºâ
# DATABASE_URL=sqlite:./database.db

# JWTÈÖçÁΩÆ
JWT_SECRET=your-secret-key-change-in-production
JWT_EXPIRES_IN=7d

# OpenAIÈÖçÁΩÆ
OPENAI_API_KEY=your-api-key
OPENAI_MODEL=gpt-3.5-turbo
OPENAI_MAX_TOKENS=2000

# ÈÉµ‰ª∂ÈÖçÁΩÆ
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-password

# Êñá‰ª∂Â≠òÂÑ≤ÈÖçÁΩÆ
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=5242880  # 5MB

# ÂâçÁ´ØURL
FRONTEND_URL=http://localhost:5173
```

---

## üóÑÔ∏è Êï∏ÊìöÂ∫´ÈÅ∑ÁßªËÖ≥Êú¨

### migrations/001_initial_schema.sql
```sql
-- Áî®Êà∂Ë°®
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  nickname VARCHAR(50),
  avatar_url VARCHAR(500),
  gender VARCHAR(10),
  age INTEGER,
  relationship_status VARCHAR(20) NOT NULL,
  language VARCHAR(10) DEFAULT 'zh',
  timezone VARCHAR(50),
  notification_enabled BOOLEAN DEFAULT true,
  privacy_level VARCHAR(20) DEFAULT 'private',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_login_at TIMESTAMP,
  is_active BOOLEAN DEFAULT true
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_created_at ON users(created_at);

-- ÈÖçÂ∞çË°®
CREATE TABLE pairings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user1_id UUID NOT NULL REFERENCES users(id),
  user2_id UUID REFERENCES users(id),
  invite_code VARCHAR(6) UNIQUE NOT NULL,
  status VARCHAR(20) DEFAULT 'pending',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  confirmed_at TIMESTAMP,
  cancelled_at TIMESTAMP,
  expires_at TIMESTAMP
);

CREATE INDEX idx_pairings_invite_code ON pairings(invite_code);
CREATE INDEX idx_pairings_user1_id ON pairings(user1_id);
CREATE INDEX idx_pairings_user2_id ON pairings(user2_id);
CREATE INDEX idx_pairings_status ON pairings(status);

-- Ê°à‰ª∂Ë°®
CREATE TABLE cases (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  pairing_id UUID NOT NULL REFERENCES pairings(id),
  title VARCHAR(200) NOT NULL,
  type VARCHAR(50) NOT NULL,
  sub_type VARCHAR(50),
  plaintiff_id UUID NOT NULL REFERENCES users(id),
  defendant_id UUID NOT NULL REFERENCES users(id),
  plaintiff_statement TEXT NOT NULL,
  defendant_statement TEXT,
  status VARCHAR(20) DEFAULT 'draft',
  mode VARCHAR(20) DEFAULT 'remote',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  submitted_at TIMESTAMP,
  completed_at TIMESTAMP
);

CREATE INDEX idx_cases_pairing_id ON cases(pairing_id);
CREATE INDEX idx_cases_plaintiff_id ON cases(plaintiff_id);
CREATE INDEX idx_cases_defendant_id ON cases(defendant_id);
CREATE INDEX idx_cases_status ON cases(status);
CREATE INDEX idx_cases_type ON cases(type);
CREATE INDEX idx_cases_created_at ON cases(created_at);

-- Ë≠âÊìöË°®
CREATE TABLE evidences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  case_id UUID NOT NULL REFERENCES cases(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id),
  file_url VARCHAR(500) NOT NULL,
  file_type VARCHAR(20) NOT NULL,
  file_size INTEGER,
  description TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_evidences_case_id ON evidences(case_id);
CREATE INDEX idx_evidences_user_id ON evidences(user_id);

-- Âà§Ê±∫Ë°®
CREATE TABLE judgments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  case_id UUID NOT NULL REFERENCES cases(id) ON DELETE CASCADE,
  judgment_content TEXT NOT NULL,
  summary TEXT,
  ai_model VARCHAR(50) NOT NULL,
  prompt_version VARCHAR(20),
  user1_acceptance BOOLEAN,
  user2_acceptance BOOLEAN,
  user1_rating INTEGER,
  user2_rating INTEGER,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_judgments_case_id ON judgments(case_id);
CREATE INDEX idx_judgments_created_at ON judgments(created_at);

-- ÂíåÂ•ΩÊñπÊ°àË°®
CREATE TABLE reconciliation_plans (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  judgment_id UUID NOT NULL REFERENCES judgments(id) ON DELETE CASCADE,
  plan_content TEXT NOT NULL,
  plan_type VARCHAR(50) NOT NULL,
  difficulty_level VARCHAR(20) NOT NULL,
  estimated_duration INTEGER,
  user1_selected BOOLEAN DEFAULT false,
  user2_selected BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_reconciliation_plans_judgment_id ON reconciliation_plans(judgment_id);
CREATE INDEX idx_reconciliation_plans_difficulty ON reconciliation_plans(difficulty_level);

-- Âü∑Ë°åË®òÈåÑË°®
CREATE TABLE execution_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  reconciliation_plan_id UUID NOT NULL REFERENCES reconciliation_plans(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id),
  action VARCHAR(50) NOT NULL,
  status VARCHAR(20) DEFAULT 'pending',
  notes TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_execution_records_plan_id ON execution_records(reconciliation_plan_id);
CREATE INDEX idx_execution_records_user_id ON execution_records(user_id);
CREATE INDEX idx_execution_records_status ON execution_records(status);

-- ÈÉµ‰ª∂È©óË≠âË°®
CREATE TABLE email_verifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) NOT NULL,
  code VARCHAR(6) NOT NULL,
  type VARCHAR(20) NOT NULL,
  expires_at TIMESTAMP NOT NULL,
  used BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_email_verifications_email ON email_verifications(email);
CREATE INDEX idx_email_verifications_code ON email_verifications(code);
CREATE INDEX idx_email_verifications_expires_at ON email_verifications(expires_at);
```

---

## üìù Git HooksÈÖçÁΩÆ

### .husky/pre-commit
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx lint-staged
```

### .husky/pre-push
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npm run test
```

### package.json (Ê∑ªÂä†)
```json
{
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ]
  }
}
```

---

**ÊñáÊ™îÁâàÊú¨**Ôºöv1.0  
**ÂâµÂª∫Êó•Êúü**Ôºö2024Âπ¥  
**ÊúÄÂæåÊõ¥Êñ∞**Ôºö2024Âπ¥

