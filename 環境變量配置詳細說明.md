# 環境變量配置詳細說明

**項目**：熊媽媽法庭  
**更新時間**：2024年12月

---

## 📋 後端環境變量

### 🔴 必需變量（必須配置）

#### 1. DATABASE_URL
- **說明**：PostgreSQL 數據庫連接字符串
- **格式**：`postgresql://postgres:[PASSWORD]@db.xxxxx.supabase.co:5432/postgres?sslmode=require`
- **獲取方式**：從 Supabase Dashboard → Settings → Database → Connection string
- **示例**：
  ```env
  DATABASE_URL=postgresql://postgres:your_password@db.abc123.supabase.co:5432/postgres?sslmode=require
  ```
- **驗證**：運行 `scripts/validate-env.sh` 檢查格式

---

#### 2. JWT_SECRET
- **說明**：JWT 令牌簽名密鑰，用於用戶認證
- **要求**：至少 32 字符的強隨機字符串
- **生成方式**：
  ```bash
  openssl rand -base64 32
  ```
- **示例**：
  ```env
  JWT_SECRET=your-super-secret-jwt-key-at-least-32-characters-long
  ```
- **安全提示**：**絕對不要**將此值提交到版本控制系統

---

#### 3. OPENAI_API_KEY
- **說明**：OpenAI API 密鑰，用於 AI 判決生成
- **格式**：以 `sk-` 開頭的字符串
- **獲取方式**：從 OpenAI Platform → API Keys → Create new secret key
- **示例**：
  ```env
  OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  ```
- **安全提示**：**絕對不要**將此值提交到版本控制系統

---

### 🟡 建議變量（強烈建議配置）

#### 4. FRONTEND_URL
- **說明**：前端應用 URL，用於 CORS 和文件 URL 生成
- **格式**：完整的 URL（包含協議）
- **示例**：
  ```env
  FRONTEND_URL=https://mother-bear-court.vercel.app
  ```
- **注意**：部署前端後更新此值

---

#### 5. ALLOWED_ORIGINS
- **說明**：允許的 CORS 來源，多個用逗號分隔
- **格式**：逗號分隔的 URL 列表
- **示例**：
  ```env
  ALLOWED_ORIGINS=https://mother-bear-court.vercel.app,https://www.motherbearcourt.com
  ```
- **注意**：必須包含 `FRONTEND_URL` 的值

---

#### 6. SMTP_HOST
- **說明**：SMTP 服務器地址（郵件服務）
- **可選**：如果不配置，郵件功能將不可用
- **示例**：
  ```env
  SMTP_HOST=smtp.sendgrid.net
  ```

---

#### 7. SMTP_PORT
- **說明**：SMTP 服務器端口
- **默認**：587（TLS）或 465（SSL）
- **示例**：
  ```env
  SMTP_PORT=587
  ```

---

#### 8. SMTP_USER
- **說明**：SMTP 用戶名
- **示例**（SendGrid）：
  ```env
  SMTP_USER=apikey
  ```

---

#### 9. SMTP_PASS
- **說明**：SMTP 密碼或 API Key
- **示例**（SendGrid）：
  ```env
  SMTP_PASS=SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  ```
- **安全提示**：**絕對不要**將此值提交到版本控制系統

---

### 🟢 可選變量（有默認值）

#### 10. PORT
- **說明**：後端服務端口
- **默認**：3000
- **示例**：
  ```env
  PORT=3000
  ```

---

#### 11. NODE_ENV
- **說明**：運行環境
- **默認**：development
- **生產環境**：
  ```env
  NODE_ENV=production
  ```

---

#### 12. JWT_EXPIRES_IN
- **說明**：JWT 令牌過期時間
- **默認**：7d（7天）
- **示例**：
  ```env
  JWT_EXPIRES_IN=7d
  ```

---

#### 13. OPENAI_MODEL
- **說明**：OpenAI 模型名稱
- **默認**：gpt-3.5-turbo
- **示例**：
  ```env
  OPENAI_MODEL=gpt-3.5-turbo
  ```

---

#### 14. OPENAI_MAX_TOKENS
- **說明**：OpenAI 最大令牌數
- **默認**：2000
- **範圍**：1-4000
- **示例**：
  ```env
  OPENAI_MAX_TOKENS=2000
  ```

---

#### 15. OPENAI_DAILY_LIMIT
- **說明**：OpenAI 每日調用限制
- **默認**：1000
- **示例**：
  ```env
  OPENAI_DAILY_LIMIT=1000
  ```

---

#### 16. UPLOAD_DIR
- **說明**：文件上傳目錄
- **默認**：./uploads
- **示例**：
  ```env
  UPLOAD_DIR=./uploads
  ```

---

#### 17. MAX_FILE_SIZE
- **說明**：最大文件大小（字節）
- **默認**：5242880（5MB）
- **示例**：
  ```env
  MAX_FILE_SIZE=5242880
  ```

---

## 📋 前端環境變量

### 🔴 必需變量

#### 1. VITE_API_BASE_URL
- **說明**：後端 API 基礎 URL
- **格式**：完整的 API URL（包含 `/api/v1`）
- **示例**：
  ```env
  VITE_API_BASE_URL=https://mother-bear-court-backend.railway.app/api/v1
  ```
- **注意**：部署後端後更新此值

---

### 🟢 可選變量

#### 2. VITE_APP_TITLE
- **說明**：應用標題
- **默認**：熊媽媽法庭
- **示例**：
  ```env
  VITE_APP_TITLE=熊媽媽法庭
  ```

---

#### 3. VITE_APP_DESCRIPTION
- **說明**：應用描述
- **默認**：大愛、包容、保護、呵護，為您的關係提供公正溫暖的判決。
- **示例**：
  ```env
  VITE_APP_DESCRIPTION=大愛、包容、保護、呵護，為您的關係提供公正溫暖的判決。
  ```

---

## 🔧 配置步驟

### 步驟 1：生成 JWT_SECRET

```bash
openssl rand -base64 32
```

複製輸出並設置到環境變量中。

---

### 步驟 2：驗證環境變量

運行驗證腳本：

```bash
chmod +x scripts/validate-env.sh
./scripts/validate-env.sh
```

---

### 步驟 3：在部署平台配置

#### Railway（後端）

1. 進入 Railway 項目
2. 點擊「Variables」
3. 添加所有後端環境變量
4. 保存並重新部署

#### Vercel（前端）

1. 進入 Vercel 項目
2. 點擊「Settings」→「Environment Variables」
3. 添加所有前端環境變量
4. 保存並重新部署

---

## 🔒 安全提示

### 絕對不要提交到版本控制：

- ✅ `.env` 文件應在 `.gitignore` 中
- ✅ 敏感信息（API Key、密碼）只存在環境變量中
- ✅ 使用 `.env.example` 作為模板（不包含真實值）

### 生產環境安全：

- ✅ 使用強隨機字符串作為 JWT_SECRET
- ✅ 定期輪換 API Key
- ✅ 限制 API 調用頻率
- ✅ 啟用 HTTPS
- ✅ 配置 CORS 白名單

---

## 📝 環境變量模板

### 後端（.env.example）

```env
# 服務器配置
NODE_ENV=production
PORT=3000

# 數據庫配置
DATABASE_URL=postgresql://postgres:[PASSWORD]@db.xxxxx.supabase.co:5432/postgres?sslmode=require

# JWT配置
JWT_SECRET=your-super-secret-jwt-key-at-least-32-characters-long
JWT_EXPIRES_IN=7d

# OpenAI配置
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
OPENAI_MODEL=gpt-3.5-turbo
OPENAI_MAX_TOKENS=2000
OPENAI_DAILY_LIMIT=1000

# 郵件配置（可選）
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASS=SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 文件存儲配置
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=5242880

# 前端URL
FRONTEND_URL=https://your-frontend-domain.vercel.app
ALLOWED_ORIGINS=https://your-frontend-domain.vercel.app
```

### 前端（.env.example）

```env
VITE_API_BASE_URL=https://your-backend-domain.railway.app/api/v1
VITE_APP_TITLE=熊媽媽法庭
VITE_APP_DESCRIPTION=大愛、包容、保護、呵護，為您的關係提供公正溫暖的判決。
```

---

## ✅ 驗證清單

部署前請確認：

- [ ] 所有必需環境變量已配置
- [ ] JWT_SECRET 長度至少 32 字符
- [ ] OPENAI_API_KEY 格式正確（以 `sk-` 開頭）
- [ ] DATABASE_URL 格式正確（以 `postgresql://` 開頭）
- [ ] FRONTEND_URL 和 ALLOWED_ORIGINS 已更新為生產 URL
- [ ] 所有敏感信息未提交到版本控制
- [ ] 運行 `scripts/validate-env.sh` 驗證通過

---

**最後更新**：2024年12月

