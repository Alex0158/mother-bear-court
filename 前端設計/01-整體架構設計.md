# 熊媽媽法庭 - 前端整體架構設計

**項目名稱**：熊媽媽法庭（Mother Bear Court）  
**品牌定位**：大愛、包容、保護、呵護  
**設計階段**：MVP開發階段  
**文檔版本**：v2.0（優化版）

---

## 📐 架構概述

### 設計理念

基於項目核心價值「大愛、包容、保護、呵護」，前端設計遵循以下理念：

1. **零門檻體驗**：快速體驗模式無需註冊即可使用
2. **溫暖親和**：視覺設計體現母熊法官的溫暖與包容
3. **清晰直觀**：流程簡單明了，降低認知負荷
4. **響應迅速**：優化加載和交互，提供即時反饋
5. **情感化設計**：通過動畫、插畫增強情感連接

---

## 🛠️ 技術棧選型

### 核心技術

**框架與語言**：
- **React 18.2+**：組件化開發，生態豐富
- **TypeScript 5.2+**：類型安全，提升代碼質量
- **Vite 5.0+**：快速構建，優秀的開發體驗

**UI組件庫**：
- **Ant Design 5.12+**：企業級UI組件，開箱即用
- **自定義主題**：基於品牌色彩定制Ant Design主題

**狀態管理**：
- **Zustand 4.4+**：輕量級狀態管理，簡單易用
- **React Query**：服務器狀態管理，緩存和同步

**路由管理**：
- **React Router 6.20+**：聲明式路由，支持嵌套路由

**HTTP客戶端**：
- **Axios 1.6+**：HTTP請求庫，支持攔截器

**樣式方案**：
- **CSS Modules**：組件級樣式隔離
- **Less/Sass**：CSS預處理器（可選）
- **Styled Components**：CSS-in-JS（可選，用於動態樣式）

**工具庫**：
- **Day.js**：日期處理
- **Lodash**：工具函數庫（按需引入）
- **React Markdown**：Markdown渲染（判決書展示）
- **Framer Motion**：複雜動畫（可選）
- **React Spring**：物理動畫（可選）

**監控與分析**：
- **Sentry**：錯誤監控和性能追蹤
- **Google Analytics**：用戶行為分析（可選）
- **Web Vitals**：核心性能指標監控
- **自定義埋點**：業務指標追蹤

---

## 📁 項目結構設計

### 目錄結構

```
frontend/
├── public/                          # 靜態資源
│   ├── images/                      # 圖片資源
│   │   ├── logo/                    # Logo和品牌圖標
│   │   ├── bear-judge/              # 母熊法官形象
│   │   ├── illustrations/           # 插畫
│   │   └── backgrounds/             # 背景圖
│   ├── fonts/                       # 字體文件
│   └── favicon.ico                  # 網站圖標
│
├── src/
│   ├── assets/                      # 資源文件
│   │   ├── styles/                  # 全局樣式
│   │   │   ├── variables.less       # 變量定義
│   │   │   ├── mixins.less          # 混入
│   │   │   ├── reset.less           # 樣式重置
│   │   │   └── global.less          # 全局樣式
│   │   ├── images/                  # 圖片資源（動態引用）
│   │   └── icons/                   # 圖標資源
│   │
│   ├── components/                   # 通用組件
│   │   ├── layout/                  # 布局組件
│   │   │   ├── Header/              # 頂部導航
│   │   │   ├── Footer/               # 底部
│   │   │   ├── Sidebar/              # 側邊欄
│   │   │   └── Container/            # 容器
│   │   ├── common/                  # 通用組件
│   │   │   ├── Button/               # 按鈕
│   │   │   ├── Input/                # 輸入框
│   │   │   ├── Card/                 # 卡片
│   │   │   ├── Modal/                # 彈窗
│   │   │   ├── Loading/              # 加載
│   │   │   ├── Empty/                # 空狀態
│   │   │   └── ErrorBoundary/        # 錯誤邊界
│   │   ├── business/                # 業務組件
│   │   │   ├── BearJudge/            # 母熊法官組件
│   │   │   ├── CaseForm/             # 案件表單
│   │   │   ├── JudgmentCard/         # 判決卡片
│   │   │   ├── ReconciliationPlan/    # 和好方案
│   │   │   └── ProgressTracker/      # 進度追蹤
│   │   └── feedback/                # 反饋組件
│   │       ├── Toast/                # 提示
│   │       ├── Notification/         # 通知
│   │       └── Message/              # 消息
│   │
│   ├── pages/                        # 頁面組件
│   │   ├── Home/                     # 首頁
│   │   ├── QuickExperience/          # 快速體驗
│   │   ├── Auth/                     # 認證相關
│   │   │   ├── Login/                # 登錄
│   │   │   ├── Register/             # 註冊
│   │   │   └── ForgotPassword/        # 忘記密碼
│   │   ├── Case/                     # 案件相關
│   │   │   ├── Create/               # 創建案件
│   │   │   ├── Detail/               # 案件詳情
│   │   │   ├── List/                  # 案件列表
│   │   │   └── Review/                # 審理中
│   │   ├── Judgment/                 # 判決相關
│   │   │   ├── Result/               # 判決結果
│   │   │   └── Detail/                # 判決詳情
│   │   ├── Reconciliation/           # 和好方案
│   │   │   ├── List/                 # 方案列表
│   │   │   └── Detail/                # 方案詳情
│   │   ├── Execution/                # 執行追蹤
│   │   │   ├── Dashboard/            # 執行看板
│   │   │   └── CheckIn/              # 打卡
│   │   ├── Profile/                  # 個人中心
│   │   │   ├── Index/                # 個人資料
│   │   │   ├── Settings/             # 設置
│   │   │   └── Pairing/              # 配對管理
│   │   └── NotFound/                 # 404頁面
│   │
│   ├── hooks/                        # 自定義Hooks
│   │   ├── useAuth.ts                # 認證相關
│   │   ├── useCase.ts                # 案件相關
│   │   ├── useJudgment.ts            # 判決相關
│   │   ├── useReconciliation.ts      # 和好方案相關
│   │   ├── usePolling.ts             # 輪詢
│   │   └── useLocalStorage.ts        # 本地存儲
│   │
│   ├── store/                        # 狀態管理
│   │   ├── authStore.ts              # 認證狀態
│   │   ├── userStore.ts              # 用戶狀態
│   │   ├── caseStore.ts              # 案件狀態
│   │   ├── judgmentStore.ts          # 判決狀態
│   │   └── uiStore.ts                # UI狀態
│   │
│   ├── services/                     # API服務
│   │   ├── api/                      # API定義
│   │   │   ├── auth.ts               # 認證API
│   │   │   ├── user.ts               # 用戶API
│   │   │   ├── case.ts               # 案件API
│   │   │   ├── judgment.ts           # 判決API
│   │   │   └── reconciliation.ts     # 和好方案API
│   │   ├── request.ts                # 請求封裝
│   │   └── interceptors.ts          # 攔截器
│   │
│   ├── utils/                        # 工具函數
│   │   ├── format.ts                 # 格式化
│   │   ├── validate.ts               # 驗證
│   │   ├── constants.ts              # 常量
│   │   ├── helpers.ts                # 輔助函數
│   │   └── storage.ts                # 存儲工具
│   │
│   ├── types/                        # TypeScript類型定義
│   │   ├── api.ts                    # API類型
│   │   ├── case.ts                   # 案件類型
│   │   ├── user.ts                   # 用戶類型
│   │   └── common.ts                 # 通用類型
│   │
│   ├── router/                       # 路由配置
│   │   ├── index.tsx                 # 路由定義
│   │   ├── routes.ts                 # 路由配置
│   │   └── guards.ts                 # 路由守衛
│   │
│   ├── App.tsx                       # 根組件
│   ├── main.tsx                      # 入口文件
│   └── vite-env.d.ts                 # Vite類型聲明
│
├── .env                              # 環境變量
├── .env.development                  # 開發環境變量
├── .env.production                   # 生產環境變量
├── .eslintrc.json                    # ESLint配置
├── .prettierrc.json                  # Prettier配置
├── tsconfig.json                     # TypeScript配置
├── vite.config.ts                    # Vite配置
└── package.json                      # 依賴配置
```

---

## 🎨 設計系統

### 色彩系統

**主色調**：
- **溫暖橘** `#FF8C42`：主要按鈕、強調元素、溫暖感
- **柔和藍** `#5B9BD5`：次要按鈕、鏈接、理性感
- **純淨白** `#FFFFFF`：背景、卡片、純潔感

**品牌色**：
- **棕色** `#8B4513`：母熊法官主色，溫暖可靠
- **金色** `#FFD700`：法袍點綴，公正權威
- **粉紅色** `#FFB6C1`：愛與呵護，點綴使用

**功能色**：
- **成功綠** `#52C41A`：成功狀態、完成標記
- **警告黃** `#FAAD14`：警告提示、注意事項
- **錯誤紅** `#FF4D4F`：錯誤狀態、拒絕操作
- **信息藍** `#1890FF`：信息提示、鏈接

**中性色**：
- **文字主色** `#262626`：主要文字
- **文字次色** `#595959`：次要文字
- **文字輔助** `#8C8C8C`：輔助文字
- **邊框色** `#D9D9D9`：邊框、分割線
- **背景色** `#FAFAFA`：頁面背景
- **卡片背景** `#FFFFFF`：卡片背景

### 字體系統

**字體族**：
- **中文字體**：`-apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif`
- **英文字體**：`-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif`
- **等寬字體**：`"SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace`

**字號系統**：
- **超大標題**：32px / 2rem（首頁主標題）
- **大標題**：24px / 1.5rem（頁面標題）
- **中標題**：20px / 1.25rem（區塊標題）
- **小標題**：18px / 1.125rem（卡片標題）
- **正文**：16px / 1rem（主要文字）
- **小字**：14px / 0.875rem（次要文字）
- **輔助文字**：12px / 0.75rem（提示文字）

**字重**：
- **Light**：300
- **Regular**：400（正文）
- **Medium**：500（強調）
- **Bold**：700（標題）

**行高**：
- **緊湊**：1.2（標題）
- **正常**：1.5（正文）
- **寬鬆**：1.8（長文本）

### 間距系統

**基礎單位**：4px

**間距等級**：
- **xs**：4px / 0.25rem
- **sm**：8px / 0.5rem
- **md**：16px / 1rem
- **lg**：24px / 1.5rem
- **xl**：32px / 2rem
- **xxl**：48px / 3rem

### 圓角系統

- **無圓角**：0px（卡片、按鈕）
- **小圓角**：4px（標籤、小元素）
- **中圓角**：8px（按鈕、輸入框）
- **大圓角**：12px（卡片、大按鈕）
- **超大圓角**：16px（特殊卡片）

### 陰影系統

- **無陰影**：`none`
- **小陰影**：`0 2px 8px rgba(0, 0, 0, 0.08)`（卡片懸停）
- **中陰影**：`0 4px 12px rgba(0, 0, 0, 0.1)`（卡片）
- **大陰影**：`0 8px 24px rgba(0, 0, 0, 0.12)`（彈窗）

---

## 🔄 狀態管理設計

### Zustand Store結構

**認證狀態（authStore）**：
```typescript
{
  token: string | null,
  user: User | null,
  isAuthenticated: boolean,
  login: (email, password) => Promise<void>,
  logout: () => void,
  register: (data) => Promise<void>,
}
```

**用戶狀態（userStore）**：
```typescript
{
  profile: UserProfile | null,
  pairing: Pairing | null,
  updateProfile: (data) => Promise<void>,
  createPairing: () => Promise<Pairing>,
  joinPairing: (code) => Promise<void>,
}
```

**案件狀態（caseStore）**：
```typescript
{
  currentCase: Case | null,
  cases: Case[],
  createCase: (data) => Promise<Case>,
  submitCase: (id) => Promise<void>,
  getCase: (id) => Promise<Case>,
}
```

**判決狀態（judgmentStore）**：
```typescript
{
  currentJudgment: Judgment | null,
  generateJudgment: (caseId) => Promise<Judgment>,
  acceptJudgment: (id, accepted) => Promise<void>,
}
```

**UI狀態（uiStore）**：
```typescript
{
  theme: 'light' | 'dark',
  language: 'zh' | 'en',
  sidebarCollapsed: boolean,
  loading: boolean,
  setTheme: (theme) => void,
  setLanguage: (lang) => void,
}
```

---

## 🌐 路由設計

### 路由結構

```
/                           # 首頁
├── /quick-experience       # 快速體驗（無需登錄）
│   ├── /create            # 創建案件
│   └── /result/:id        # 判決結果
│
├── /auth                   # 認證（未登錄）
│   ├── /login             # 登錄
│   ├── /register          # 註冊
│   └── /forgot-password   # 忘記密碼
│
├── /case                   # 案件（需登錄）
│   ├── /create            # 創建案件
│   ├── /list              # 案件列表
│   ├── /:id               # 案件詳情
│   └── /:id/review        # 審理中
│
├── /judgment               # 判決（需登錄）
│   ├── /:id               # 判決詳情
│   └── /:id/result        # 判決結果
│
├── /reconciliation         # 和好方案（需登錄）
│   ├── /:judgmentId       # 方案列表
│   └── /:judgmentId/:id   # 方案詳情
│
├── /execution              # 執行追蹤（需登錄）
│   ├── /dashboard         # 執行看板
│   └── /:planId/checkin   # 打卡
│
└── /profile                # 個人中心（需登錄）
    ├── /index             # 個人資料
    ├── /settings          # 設置
    └── /pairing           # 配對管理
```

### 路由守衛

**公開路由**：首頁、快速體驗、認證頁面
**受保護路由**：案件、判決、和好方案、執行追蹤、個人中心
**條件路由**：某些功能需要配對後才能使用

---

## 📱 響應式設計

### 斷點定義

- **移動端**：< 768px
- **平板**：768px - 1024px
- **桌面**：> 1024px
- **大桌面**：> 1440px

### 適配策略

**移動端優先**：先設計移動端，再擴展到桌面端
**彈性布局**：使用Flexbox和Grid實現響應式
**圖片適配**：使用srcset和picture標籤
**字體縮放**：使用rem單位，根據屏幕大小調整

---

## ⚡ 性能優化策略

### 性能指標目標

**核心性能指標（Web Vitals）**：
- **FCP（First Contentful Paint）**：< 1.8秒
- **LCP（Largest Contentful Paint）**：< 2.5秒
- **CLS（Cumulative Layout Shift）**：< 0.1
- **TTI（Time to Interactive）**：< 3.5秒
- **FID（First Input Delay）**：< 100毫秒

### 代碼分割

- **路由級別**：每個路由頁面獨立打包，使用React.lazy動態導入
- **組件級別**：大型組件（>50KB）使用React.lazy動態導入
- **第三方庫**：按需加載，避免全量引入（如Ant Design按需引入）
- **公共代碼**：提取公共代碼到vendor chunk，提高緩存效率

### 資源優化

- **圖片優化**：
  - WebP格式優先，PNG/JPG作為降級方案
  - 響應式圖片（srcset、picture標籤）
  - 圖片懶加載（Intersection Observer）
  - 圖片壓縮（TinyPNG、ImageOptim）
- **字體優化**：
  - 字體子集化（只包含使用的字符）
  - 預加載關鍵字體（preload）
  - 使用font-display: swap避免FOIT
  - 系統字體作為降級方案
- **CSS優化**：
  - 提取關鍵CSS（Critical CSS）
  - 延遲加載非關鍵CSS
  - CSS Modules避免樣式衝突
  - 移除未使用的CSS（PurgeCSS）

### 緩存策略

- **靜態資源**：
  - 長期緩存（1年），文件名包含hash
  - CDN加速，全球分發
  - 版本控制，自動更新
- **API響應**：
  - React Query緩存（staleTime: 5分鐘）
  - 根據數據類型調整緩存時間
  - 自動失效和重新獲取
- **本地存儲**：
  - localStorage：用戶設置、主題、語言（長期存儲）
  - sessionStorage：臨時數據、表單草稿（會話存儲）
  - IndexedDB：大量數據、離線數據（結構化存儲）

### 加載優化

- **骨架屏**：
  - 內容加載時顯示骨架屏
  - 保持布局穩定，減少CLS
  - 提升感知性能
- **預加載**：
  - 關鍵路由預加載（link rel="prefetch"）
  - 關鍵資源預加載（link rel="preload"）
  - DNS預解析（link rel="dns-prefetch"）
- **懶加載**：
  - 圖片懶加載（Intersection Observer）
  - 組件懶加載（React.lazy + Suspense）
  - 路由懶加載（動態import）

### PWA支持

- **Service Worker**：
  - 離線功能支持
  - 資源緩存策略（Cache First、Network First）
  - 後台同步（Background Sync）
- **Web App Manifest**：
  - 安裝提示配置
  - 圖標和啟動畫面配置
  - 主題顏色配置
- **離線頁面**：
  - 網絡斷開時的友好提示
  - 離線功能說明
  - 重試連接按鈕

---

## 🔒 安全設計

### 數據安全

- **敏感信息**：不在前端存儲敏感信息
- **XSS防護**：輸入驗證和輸出轉義
- **CSRF防護**：使用Token機制

### 認證安全

- **Token存儲**：存儲在httpOnly Cookie或內存中
- **Token刷新**：自動刷新過期Token
- **登出清理**：登出時清除所有本地數據

---

## 📊 監控與分析

### 錯誤監控

- **錯誤邊界**：
  - React ErrorBoundary捕獲組件錯誤
  - 組件級錯誤邊界（關鍵組件）
  - 全局錯誤邊界（根組件）
  - 錯誤恢復機制（重試、降級）
- **全局錯誤**：
  - window.onerror捕獲全局錯誤
  - unhandledrejection捕獲Promise錯誤
  - 錯誤分類和優先級
- **錯誤上報**：
  - 集成Sentry錯誤監控服務
  - 錯誤上下文信息（用戶、設備、環境）
  - 錯誤聚合和分析
  - 錯誤通知和告警

### 性能監控

- **性能指標**：
  - Web Vitals監控（FCP、LCP、CLS、TTI、FID）
  - 自定義性能指標（業務相關）
  - 性能數據上報和分析
  - 性能趨勢分析
- **API性能**：
  - API響應時間監控
  - API錯誤率監控
  - API慢請求分析
  - API性能優化建議
- **用戶行為**：
  - 頁面訪問追蹤（訪問時間、停留時間、滾動深度）
  - 按鈕點擊追蹤（CTA點擊、功能點擊）
  - 表單填寫追蹤（填寫進度、完成時間、放棄點）
  - 轉化事件追蹤（註冊、登錄、完成判決、執行方案）

### 數據分析

- **用戶分析**：
  - 用戶畫像分析
  - 用戶行為路徑分析
  - 用戶留存分析
  - 用戶流失分析
- **轉化分析**：
  - 轉化漏斗分析
  - 轉化率分析
  - 轉化優化建議
  - A/B測試結果分析
- **業務分析**：
  - 案件類型分析
  - 判決滿意度分析
  - 和好方案執行率分析
  - 關係健康分數分析

---

## 🎯 無障礙設計

### 可訪問性

- **語義化HTML**：使用正確的HTML標籤
- **ARIA標籤**：為交互元素添加ARIA標籤
- **鍵盤導航**：支持完整的鍵盤操作
- **屏幕閱讀器**：兼容屏幕閱讀器

### 對比度

- **文字對比度**：符合WCAG AA標準（4.5:1）
- **圖標對比度**：確保圖標清晰可見

---

**文檔版本**：v2.0（優化版）  
**創建日期**：2024年  
**最後更新**：2024年（已整合性能監控、錯誤處理、PWA支持等優化）

