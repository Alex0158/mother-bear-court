# 前端「接口不存在」錯誤修復指南

## 🔍 問題分析

### 錯誤表現
在 https://mother-bear-court.vercel.app/quick-experience/create 頁面上顯示「接口不存在」

### 可能原因

1. **Vercel 環境變量未配置**
   - 前端調用 API 時使用的 baseURL 是默認值 `http://localhost:3000/api/v1`
   - 這會導致瀏覽器嘗試訪問 `http://localhost:3000/api/v1/sessions/quick`
   - 但生產環境中，localhost 無法訪問，應該使用 Railway 後端 URL

2. **API 路徑配置錯誤**
   - 前端代碼：`POST /sessions/quick`
   - 實際完整路徑：`baseURL + /sessions/quick`
   - 如果 baseURL 是 `https://mother-bear-court-production.up.railway.app/api/v1`
   - 完整路徑應該是：`https://mother-bear-court-production.up.railway.app/api/v1/sessions/quick` ✅ 正確

## ✅ 修復步驟

### 步驟1：配置 Vercel 環境變量

1. **登錄 Vercel Dashboard**
   - 訪問：https://vercel.com/dashboard
   - 選擇項目：`mother-bear-court`

2. **進入環境變量設置**
   - 點擊項目 → Settings → Environment Variables

3. **添加/更新環境變量**

   **變量名**：`VITE_API_BASE_URL`
   
   **變量值**：`https://mother-bear-court-production.up.railway.app/api/v1`
   
   **環境**：選擇 `Production`, `Preview`, `Development`（全選）

4. **保存並重新部署**
   - 點擊 "Save"
   - 進入 "Deployments" 頁面
   - 點擊最新的部署旁邊的 "..." → "Redeploy"
   - 或等待下次自動部署

### 步驟2：驗證配置

重新部署後，訪問頁面並打開瀏覽器開發者工具（F12）：

1. **檢查 Network 標籤**
   - 查看 API 請求的 URL
   - 應該是：`https://mother-bear-court-production.up.railway.app/api/v1/sessions/quick`

2. **檢查 Console 標籤**
   - 查看是否有 CORS 錯誤
   - 查看是否有其他錯誤信息

3. **檢查錯誤信息**
   - 如果還是「接口不存在」，檢查返回的狀態碼：
     - 404：路由不存在（檢查後端路由）
     - 401：認證失敗
     - 403：CORS 問題（檢查 Railway 環境變量）

### 步驟3：檢查 Railway CORS 配置

確保 Railway 後端的環境變量已正確設置：

**變量名**：`FRONTEND_URL`
**變量值**：`https://mother-bear-court.vercel.app`

**變量名**：`ALLOWED_ORIGINS`
**變量值**：`https://mother-bear-court.vercel.app,http://localhost:5173`

## 🔧 快速檢查清單

- [ ] Vercel 環境變量 `VITE_API_BASE_URL` 已設置為生產後端 URL
- [ ] Railway 環境變量 `FRONTEND_URL` 已設置為 Vercel 前端 URL
- [ ] Railway 環境變量 `ALLOWED_ORIGINS` 包含 Vercel 前端 URL
- [ ] Railway 後端 `trust proxy` 已修復（✅ 已完成）
- [ ] 前端已重新部署
- [ ] 瀏覽器緩存已清除（Ctrl+Shift+R 或 Cmd+Shift+R）

## 📝 測試步驟

1. **清除瀏覽器緩存**：`Ctrl+Shift+R` (Windows) 或 `Cmd+Shift+R` (Mac)

2. **訪問頁面**：
   ```
   https://mother-bear-court.vercel.app/quick-experience/create
   ```

3. **打開開發者工具**（F12）→ Network 標籤

4. **檢查 API 請求**：
   - 應該看到對 `https://mother-bear-court-production.up.railway.app/api/v1/sessions/quick` 的 POST 請求
   - 狀態碼應該是 200 或 201（成功）

5. **如果還有錯誤**：
   - 查看 Network 中請求的完整 URL
   - 查看 Response 內容
   - 查看 Console 中的錯誤信息

## 🚨 常見問題

### Q1: 還是顯示「接口不存在」？

**A**: 檢查：
1. Vercel 環境變量是否正確設置並重新部署
2. Railway 後端是否正常運行：`curl https://mother-bear-court-production.up.railway.app/health`
3. 瀏覽器 Network 中請求的實際 URL 是什麼

### Q2: 出現 CORS 錯誤？

**A**: 檢查 Railway 環境變量：
- `FRONTEND_URL`: 應該包含 Vercel 前端 URL
- `ALLOWED_ORIGINS`: 應該包含 `https://mother-bear-court.vercel.app`

### Q3: 403 Forbidden？

**A**: 可能是 Railway 的 CORS 配置問題，檢查 `ALLOWED_ORIGINS` 是否正確

## ✅ 修復完成檢查

修復完成後，頁面應該能夠：
- ✅ 正常加載，無「接口不存在」錯誤
- ✅ 自動創建 Session（無錯誤提示）
- ✅ 可以正常輸入和提交案件

