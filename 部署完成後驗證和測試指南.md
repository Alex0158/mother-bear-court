# 部署完成後驗證和測試指南

**項目**：熊媽媽法庭  
**當前狀態**：後端已部署，前端環境變量已配置  
**最後更新**：2024年12月

---

## 📊 當前完成狀態

### ✅ 已完成
- [x] Railway 後端部署成功
- [x] 後端健康檢查通過
- [x] 後端 URL 已獲取：`https://mother-bear-court-production.up.railway.app`
- [x] Vercel 前端環境變量已配置（`VITE_API_BASE_URL`）
- [x] 前端已重新部署

---

## 🎯 下一步行動（按優先級）

### 優先級 1：驗證前端部署狀態（5 分鐘）🔴

**目標**：確認前端已成功部署並可以訪問

#### 步驟 1.1：檢查 Vercel 部署狀態

1. **登錄 Vercel Dashboard**
   - 訪問：https://vercel.com/dashboard
   - 選擇你的項目

2. **查看 Deployments 標籤**
   - 點擊 **"Deployments"** 標籤
   - 確認最新部署狀態為 **"Ready"**（綠色）

3. **記錄前端 URL**
   - 在部署列表中，找到最新部署
   - 點擊部署，查看 **"Domains"** 或頂部的 URL
   - 格式通常是：`https://mother-bear-court.vercel.app` 或 `https://xxx.vercel.app`
   - **複製這個 URL** ⭐

#### 步驟 1.2：測試前端訪問

1. **在瀏覽器中打開前端 URL**
   - 直接訪問你剛才記錄的 URL

2. **檢查頁面是否正常加載**
   - ✅ 頁面應該正常顯示
   - ✅ 沒有明顯的錯誤提示
   - ✅ 頁面結構正常

3. **打開瀏覽器開發者工具**
   - 按 `F12` 或 `Cmd+Option+I` (Mac) / `Ctrl+Shift+I` (Windows)
   - 切換到 **Console** 標籤

4. **檢查控制台錯誤**
   - ✅ 應該沒有紅色錯誤信息
   - ⚠️ 如果有警告（黃色），可以暫時忽略

---

### 優先級 2：驗證環境變量是否生效（5 分鐘）🟡

**目標**：確認前端正確讀取了後端 URL

#### 步驟 2.1：檢查環境變量值

在瀏覽器控制台（Console）中運行：

```javascript
console.log(import.meta.env.VITE_API_BASE_URL)
```

**預期結果**：
```
https://mother-bear-court-production.up.railway.app/api/v1
```

**如果顯示 `undefined` 或錯誤**：
- ❌ 環境變量未正確配置
- ❌ 需要重新檢查 Vercel 環境變量設置
- ❌ 可能需要重新部署

**如果顯示正確的 URL**：
- ✅ 環境變量配置成功

---

### 優先級 3：更新 Railway CORS 配置（10 分鐘）🟡

**目標**：允許前端訪問後端 API

#### 步驟 3.1：獲取前端 URL

從步驟 1.1 中，你應該已經記錄了前端 URL，例如：
```
https://mother-bear-court.vercel.app
```

#### 步驟 3.2：在 Railway 添加環境變量

1. **登錄 Railway Dashboard**
   - 訪問：https://railway.app/dashboard
   - 選擇你的項目 → backend 服務

2. **進入 Variables 標籤**
   - 點擊 **"Variables"** 標籤

3. **添加 `FRONTEND_URL`**
   - 點擊 **"+ New Variable"**
   - Key: `FRONTEND_URL`
   - Value: `https://你的Vercel前端URL`（例如：`https://mother-bear-court.vercel.app`）
   - 點擊 **"Add"** 或 **"Save"**

4. **添加 `ALLOWED_ORIGINS`**
   - 點擊 **"+ New Variable"**
   - Key: `ALLOWED_ORIGINS`
   - Value: `https://你的Vercel前端URL,http://localhost:5173`
     - 例如：`https://mother-bear-court.vercel.app,http://localhost:5173`
   - 點擊 **"Add"** 或 **"Save"**

5. **等待重新部署**
   - Railway 會自動檢測環境變量變化並重新部署
   - 等待 1-2 分鐘

---

### 優先級 4：測試前後端連接（10 分鐘）🟢

**目標**：驗證前端可以成功調用後端 API

#### 步驟 4.1：測試 API 連接

1. **打開前端應用**
   - 在瀏覽器中訪問前端 URL

2. **打開開發者工具**
   - 按 `F12`
   - 切換到 **Network** 標籤

3. **觸發一個 API 請求**
   - 如果前端有健康檢查功能，觸發它
   - 或執行任何會調用後端 API 的操作

4. **檢查 Network 請求**
   - 在 Network 標籤中，查找對後端的請求
   - 確認請求 URL 正確：`https://mother-bear-court-production.up.railway.app/api/v1/...`
   - 檢查響應狀態：
     - ✅ `200 OK`：成功
     - ❌ `CORS error`：CORS 配置問題
     - ❌ `404 Not Found`：路由問題
     - ❌ `500 Internal Server Error`：後端錯誤

#### 步驟 4.2：測試健康檢查端點

在瀏覽器控制台運行：

```javascript
fetch('https://mother-bear-court-production.up.railway.app/api/v1/health')
  .then(res => res.json())
  .then(data => console.log('健康檢查成功:', data))
  .catch(err => console.error('健康檢查失敗:', err))
```

**預期結果**：
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    ...
  }
}
```

**如果出現 CORS 錯誤**：
- ❌ 需要檢查 Railway 的 `ALLOWED_ORIGINS` 配置
- ❌ 確認前端 URL 已正確添加到 `ALLOWED_ORIGINS`

---

### 優先級 5：端到端功能測試（15 分鐘）🟢

**目標**：驗證核心功能正常工作

#### 測試項目

1. **快速體驗模式**
   - [ ] 可以進入快速體驗頁面
   - [ ] 可以填寫案件信息
   - [ ] 可以提交案件
   - [ ] AI 判決可以正常生成
   - [ ] 判決結果可以正常顯示

2. **用戶註冊登錄**（如果已實現）
   - [ ] 可以註冊新帳號
   - [ ] 可以登錄
   - [ ] 登錄後可以訪問受保護的頁面

3. **錯誤處理**
   - [ ] 網絡錯誤時有適當的提示
   - [ ] API 錯誤時有適當的提示
   - [ ] 頁面不會崩潰

---

## 📋 快速檢查清單

### 立即檢查（優先級 1-2）

- [ ] Vercel 部署狀態為 "Ready"
- [ ] 前端 URL 已記錄
- [ ] 前端頁面可以正常加載
- [ ] 瀏覽器控制台無嚴重錯誤
- [ ] `import.meta.env.VITE_API_BASE_URL` 顯示正確的 URL

### 配置更新（優先級 3）

- [ ] Railway 已添加 `FRONTEND_URL`
- [ ] Railway 已添加 `ALLOWED_ORIGINS`
- [ ] Railway 已重新部署

### 連接測試（優先級 4）

- [ ] 前端可以發送 API 請求
- [ ] API 請求返回 `200 OK`
- [ ] 沒有 CORS 錯誤
- [ ] 健康檢查端點可以正常訪問

### 功能測試（優先級 5）

- [ ] 快速體驗模式可以正常使用
- [ ] 核心功能正常工作
- [ ] 錯誤處理正常

---

## 🚨 常見問題排查

### 問題 1：前端無法訪問後端（CORS 錯誤）

**症狀**：
- 瀏覽器控制台顯示 CORS 錯誤
- Network 請求失敗，狀態為 `CORS policy`

**解決方案**：
1. 確認 Railway 的 `ALLOWED_ORIGINS` 包含前端 URL
2. 確認 `FRONTEND_URL` 已正確設置
3. 等待 Railway 重新部署完成
4. 清除瀏覽器緩存後重試

---

### 問題 2：環境變量未生效

**症狀**：
- `import.meta.env.VITE_API_BASE_URL` 顯示 `undefined`
- API 請求發送到錯誤的 URL

**解決方案**：
1. 確認 Vercel 環境變量 Key 為 `VITE_API_BASE_URL`（完全一致）
2. 確認 Value 包含完整 URL 和 `/api/v1` 後綴
3. 確認已重新部署前端
4. 清除瀏覽器緩存後重試

---

### 問題 3：前端頁面無法加載

**症狀**：
- 瀏覽器顯示 404 或無法訪問
- Vercel 部署狀態不是 "Ready"

**解決方案**：
1. 檢查 Vercel 部署日誌
2. 確認構建成功
3. 檢查是否有構建錯誤
4. 嘗試重新部署

---

## ✅ 完成標準

### 部署成功標準

- ✅ 前端可以正常訪問
- ✅ 後端可以正常訪問
- ✅ 前端可以成功調用後端 API
- ✅ 沒有 CORS 錯誤
- ✅ 核心功能可以正常使用

### 如果所有檢查都通過

🎉 **恭喜！你的應用已經成功部署並可以正常使用了！**

---

## 📞 需要幫助？

如果遇到問題，請告訴我：

1. **你現在在哪一步？**
2. **遇到了什麼具體問題？**
3. **錯誤信息是什麼？**（可以截圖或複製錯誤信息）

我可以幫你：
- 分析錯誤日誌
- 檢查配置是否正確
- 提供解決方案

---

**最後更新**：2024年12月

