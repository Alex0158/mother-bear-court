# 快速部署行動清單

**項目**：熊媽媽法庭  
**預計總時間**：3-4 小時（可分 2-3 天完成）

---

## 📋 部署前準備（我來完成）

### ✅ 已完成
- [x] 部署腳本準備完成
- [x] 部署文檔完整
- [x] 環境變量模板準備完成
- [x] 代碼檢查完成

---

## 🎯 你需要完成的步驟

### 第一階段：第三方服務配置（1-2 小時）

#### Step 1: 配置 OpenAI API（30 分鐘）🔴 必須 ✅ **已完成**

**操作步驟**：
1. 訪問 https://platform.openai.com
2. 註冊/登錄賬號
3. 獲取 API Key：
   - 訪問 https://platform.openai.com/api-keys
   - 點擊「Create new secret key」
   - **重要**：複製並保存 API Key（只顯示一次）
4. 設置付款方式：
   - 訪問 https://platform.openai.com/account/billing
   - 添加信用卡
   - 設置使用限額（建議：$50/月）

**完成後**：你將獲得 `OPENAI_API_KEY`（格式：`sk-xxxxx`）

**✅ 狀態**：API Key 已配置到 `backend/.env` 文件中

---

#### Step 2: 配置 Supabase 數據庫（20 分鐘）🔴 必須 ✅ **已完成**

**操作步驟**：
1. 訪問 https://supabase.com
2. 使用 GitHub/Google 登錄
3. 創建新項目：
   - 點擊「New Project」
   - 項目名稱：`Mother Bear Court`
   - 設置數據庫密碼（**請記住這個密碼**）
   - 選擇區域（建議：離你最近的區域）
4. 獲取連接字符串：
   - 在項目設置 → Database → Connection string
   - 複製連接字符串
   - 格式：`postgresql://postgres:[PASSWORD]@db.xxxxx.supabase.co:5432/postgres`

**完成後**：你將獲得 `DATABASE_URL`

---

#### Step 3: 配置 SMTP 郵件服務（15 分鐘）🟡 可選但建議

**操作步驟**：
1. 訪問 https://sendgrid.com
2. 註冊免費賬號
3. 驗證發件人郵箱
4. 創建 API Key：
   - Settings → API Keys → Create API Key
   - 保存 API Key

**完成後**：你將獲得 `SMTP_PASS`（SendGrid API Key）

---

### 第二階段：部署平台註冊（30-45 分鐘）

#### Step 4: 推送代碼到 GitHub（必須先完成）🔴 必須

**重要**：Vercel 需要項目在 GitHub 上才能部署！

**操作步驟**：
1. **初始化 Git 倉庫**（如果還沒初始化）：
   ```bash
   cd /Users/alex/Desktop/CJ
   ./scripts/setup-git.sh
   ```
   或手動執行：
   ```bash
   git init
   git add .
   git commit -m "Initial commit: 熊媽媽法庭 MVP"
   ```

2. **在 GitHub 創建倉庫**：
   - 訪問 https://github.com
   - 點擊「New repository」
   - 填寫倉庫名稱（如：`mother-bear-court`）
   - **不要**勾選「Initialize with README」
   - 點擊「Create repository」

3. **推送代碼到 GitHub**：
   ```bash
   git remote add origin https://github.com/你的用戶名/倉庫名.git
   git branch -M main
   git push -u origin main
   ```

**詳細指南**：請參考 `GitHub推送和Vercel部署指南.md`

---

#### Step 5: 註冊 Vercel（前端部署）（15 分鐘）🔴 必須

**前置條件**：代碼必須已在 GitHub 上

**操作步驟**：
1. 訪問 https://vercel.com
2. 使用 GitHub 賬號登錄
3. 導入項目：
   - 點擊「Add New Project」
   - 選擇你的 GitHub 倉庫
   - **重要**：設置 Root Directory 為 `frontend`
4. 配置構建設置：
   - Framework Preset: `Vite`（通常自動檢測）
   - Build Command: `npm run build`
   - Output Directory: `dist`
   - Install Command: `npm install`
5. 配置環境變量：
   - 添加 `VITE_API_URL`（後端 URL，可稍後更新）

**完成後**：你將獲得前端 URL（如：`https://xxx.vercel.app`）

**詳細指南**：請參考 `GitHub推送和Vercel部署指南.md`

---

#### Step 6: 註冊 Railway（後端部署）（15 分鐘）🔴 必須

**操作步驟**：
1. 訪問 https://railway.app
2. 使用 GitHub 賬號登錄
3. 創建新項目：
   - 點擊「New Project」
   - 選擇「Deploy from GitHub repo」
   - 選擇項目倉庫
4. 選擇 `backend` 目錄作為根目錄

**完成後**：你將獲得後端 URL（如：`https://xxx.railway.app`）

---

### 第三階段：環境變量配置（30 分鐘）

#### Step 6: 配置後端環境變量（在 Railway 中）

**在 Railway 項目設置 → Variables 中添加**：

```env
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://...（從 Supabase 獲取）
JWT_SECRET=（運行命令生成：openssl rand -base64 32）
OPENAI_API_KEY=sk-...（從 OpenAI 獲取）
OPENAI_MODEL=gpt-3.5-turbo
OPENAI_MAX_TOKENS=2000
FRONTEND_URL=https://...（部署前端後獲取）
ALLOWED_ORIGINS=https://...（部署前端後獲取）
```

**生成 JWT_SECRET 命令**：
```bash
openssl rand -base64 32
```

---

#### Step 7: 配置前端環境變量（在 Vercel 中）

**在 Vercel 項目設置 → Environment Variables 中添加**：

```env
VITE_API_BASE_URL=https://...（部署後端後獲取，格式：https://xxx.railway.app/api/v1）
```

---

### 第四階段：執行部署（30 分鐘）

#### Step 8: 部署後端

**在 Railway 中**：
1. Railway 會自動檢測到 `backend` 目錄
2. 自動運行構建和部署
3. 等待部署完成
4. 記錄部署 URL

**如果遇到問題**，檢查：
- 環境變量是否全部配置
- 構建日誌是否有錯誤

---

#### Step 9: 部署前端

**在 Vercel 中**：
1. 點擊「Deploy」
2. 等待構建完成
3. 記錄部署 URL

**如果遇到問題**，檢查：
- 環境變量是否配置
- 構建日誌是否有錯誤

---

#### Step 10: 更新 CORS 配置

**部署前端後，更新後端環境變量**：

在 Railway 中更新：
```env
FRONTEND_URL=https://xxx.vercel.app（你的前端URL）
ALLOWED_ORIGINS=https://xxx.vercel.app（你的前端URL）
```

然後重新部署後端。

---

### 第五階段：數據庫遷移（10 分鐘）

#### Step 11: 運行數據庫遷移

**在本地執行**（需要先配置本地 `.env` 連接生產數據庫）：

```bash
cd backend
# 設置生產數據庫 URL
export DATABASE_URL="postgresql://..."
# 運行遷移
npm run prisma:migrate deploy
```

**或在 Supabase Dashboard 中執行**：
1. 打開 SQL Editor
2. 運行 Prisma 生成的遷移 SQL

---

### 第六階段：測試驗證（30 分鐘）

#### Step 12: 端到端測試

**測試項目**：
- [ ] 訪問前端 URL，頁面正常加載
- [ ] 測試快速體驗模式完整流程
- [ ] 測試用戶註冊登錄
- [ ] 測試案件創建
- [ ] 測試 AI 判決生成
- [ ] 檢查後端日誌無錯誤

---

## 📞 需要幫助？

### 我可以提供的協助：

1. **遠程指導**
   - 你分享屏幕，我指導你操作
   - 實時回答問題

2. **問題排查**
   - 部署失敗時幫你分析日誌
   - 提供解決方案

3. **配置檢查**
   - 檢查環境變量配置
   - 驗證部署設置

---

## ⏱️ 時間估算

| 階段 | 預計時間 | 可以分開完成 |
|------|----------|------------|
| 第三方服務配置 | 1-2 小時 | ✅ 可以分 2 天 |
| 部署平台註冊 | 30-45 分鐘 | ✅ 可以分 1 天 |
| 環境變量配置 | 30 分鐘 | ✅ 可以分 1 天 |
| 執行部署 | 30 分鐘 | ✅ 可以分 1 天 |
| 數據庫遷移 | 10 分鐘 | ✅ 可以分 1 天 |
| 測試驗證 | 30 分鐘 | ✅ 可以分 1 天 |
| **總計** | **3-4 小時** | **可分 2-3 天完成** |

---

## ✅ 完成檢查清單

### 部署前
- [ ] OpenAI API 配置完成
- [ ] Supabase 數據庫配置完成
- [ ] SMTP 郵件服務配置完成（可選）
- [ ] Vercel 賬號註冊完成
- [ ] Railway 賬號註冊完成

### 部署中
- [ ] 後端環境變量配置完成
- [ ] 前端環境變量配置完成
- [ ] 後端部署成功
- [ ] 前端部署成功
- [ ] CORS 配置更新

### 部署後
- [ ] 數據庫遷移完成
- [ ] 端到端測試通過
- [ ] 所有核心功能正常
- [ ] 錯誤日誌檢查完成

---

## 🎯 下一步

**準備好了嗎？**

1. **如果你準備開始**：
   - 告訴我，我可以實時指導
   - 或按照 `第三方接口註冊和配置指南.md` 開始

2. **如果你有問題**：
   - 隨時問我
   - 我可以遠程協助

3. **如果你遇到錯誤**：
   - 分享錯誤信息
   - 我可以幫你排查

---

**讓我們開始吧！** 🚀

