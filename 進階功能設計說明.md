# 進階功能設計說明

## 🎯 功能定位

**目標用戶**：雙方都已註冊並配對成功的用戶  
**核心價值**：通過收集雙方背景信息和關係檔案，讓AI能夠更深入從心理學角度分析，提供更貼切、更個性化的判決和建議

---

## 📋 功能模塊

### 1. 用戶背景設定系統

#### 1.1 個人背景信息

**教育背景**：
- 學歷（高中/大專/本科/碩士/博士/其他）
- 專業領域（可選）
- 畢業院校（可選）

**文化背景**：
- 民族/種族（可選）
- 文化認同（可選，多選：東方文化/西方文化/混合文化等）
- 成長環境（城市/鄉村/小鎮等）

**宗教背景**：
- 宗教信仰（無/基督教/伊斯蘭教/佛教/印度教/猶太教/其他）
- 宗教實踐程度（不實踐/偶爾實踐/經常實踐/嚴格實踐）

**家庭背景**（可選）：
- 家庭結構（獨生子女/有兄弟姐妹/單親家庭/重組家庭等）
- 父母關係（和諧/一般/緊張/離異等）
- 家庭經濟狀況（可選）

**性格特質**（可選，可通過測試或自評）：
- MBTI類型（可選）
- 大五人格特質（開放性/責任心/外向性/宜人性/神經質）
- 溝通風格（直接/間接/理性/感性等）

**其他相關信息**：
- 職業（可選）
- 興趣愛好（可選，多選）
- 價值觀重點（可選，多選：家庭/事業/自由/穩定等）

#### 1.2 隱私保護

- 所有背景信息默認為私密，僅用於AI分析
- 用戶可選擇是否與配對對象共享部分信息
- 背景信息不會在判決書中直接顯示，僅用於AI分析

---

### 2. 關係檔案系統

#### 2.1 關係基本信息

**關係階段**：
- 在一起多久（天數/月數/年數）
- 關係狀態（新戀情/穩定關係/長期關係/已婚等）
- 關係里程碑（第一次約會/第一次旅行/同居/訂婚/結婚等，可選）

**地理位置**：
- 雙方所在城市/國家
- 是否異地（是/否）
- 異地距離（如適用）
- 見面頻率（如適用）

#### 2.2 底線和雷點（重要）

**角色A的底線**（可選，多條）：
- 例如：「不能接受欺騙」「不能接受冷暴力」「不能接受不尊重家人」等
- 可手動添加，也可從歷史案件中提取

**角色B的底線**（可選，多條）：
- 例如：「不能接受不信任」「不能接受過度控制」等
- 可手動添加，也可從歷史案件中提取

**雙方共同底線**（可選）：
- 雙方都認同的底線

**歷史衝突中的雷點**（可選）：
- AI可從歷史案件中自動提取
- 用戶確認後保存

#### 2.3 喜好和偏好

**角色A的喜好**（可選，多選）：
- 喜歡的活動、食物、電影類型、音樂風格等

**角色B的喜好**（可選，多選）：
- 喜歡的活動、食物、電影類型、音樂風格等

**共同喜好**（可選）：
- 雙方都喜歡的事物

**不喜歡的事物**（可選）：
- 雙方都不喜歡的事物

#### 2.4 溝通模式

**平時溝通頻率**（可選）：
- 每天/每週幾次/偶爾等

**溝通方式偏好**（可選，多選）：
- 文字/語音/視頻/面對面

**衝突時的溝通方式**（可選）：
- 冷戰/爭吵/理性討論/尋求第三方等

#### 2.5 關係優勢和挑戰

**關係優勢**（可選，多選）：
- 雙方認為關係中的優勢
- 例如：「互相理解」「共同興趣」「價值觀一致」等

**關係挑戰**（可選，多選）：
- 雙方認為關係中的挑戰
- 例如：「溝通不暢」「價值觀差異」「生活習慣不同」等

#### 2.6 歷史記錄（自動生成）

**過往案件類型分布**：
- 自動統計過往提交的案件類型
- 識別常見衝突類型

**過往判決的責任分比例趨勢**：
- 統計歷史判決中的責任分比例
- 識別責任分配模式

**過往和好方案的執行情況**：
- 統計和好方案的執行率
- 識別高成功率的方案類型

**關係改善趨勢**（可選）：
- 基於歷史數據分析關係改善趨勢
- 識別關係健康狀況

---

## 🤖 AI應用方式

### 1. 個性化判決生成

**背景信息應用**：
- **文化背景**：考慮不同文化背景下的價值觀差異，使用適當的語言和建議
- **宗教背景**：尊重宗教信仰，避免觸及宗教敏感話題
- **性格特質**：根據性格特質調整溝通建議，例如對內向型用戶提供更溫和的建議
- **教育背景**：根據教育水平調整語言複雜度

**關係檔案應用**：
- **底線和雷點**：特別注意是否觸及雙方的底線，如果觸及，在判決中明確指出並提供修復建議
- **關係階段**：根據關係階段調整建議，新戀情和長期關係的建議不同
- **地理位置**：如果是異地戀，提供適合異地戀的建議
- **溝通模式**：基於雙方的溝通模式，提供更貼切的溝通建議
- **歷史記錄**：考慮歷史案件中的責任分比例趨勢，確保判決一致性

### 2. 精準和好方案推薦

**基於喜好**：
- 推薦雙方都喜歡的活動
- 避免推薦雙方都不喜歡的事物

**基於地理位置**：
- 如果是異地戀，推薦適合異地戀的活動
- 如果同城，推薦適合當地的活動

**基於關係階段**：
- 新戀情：推薦建立親密感的活動
- 穩定關係：推薦維護關係的活動
- 長期關係：推薦深化關係的活動

**基於溝通模式**：
- 根據雙方的溝通方式偏好，推薦適合的溝通練習

**基於歷史記錄**：
- 優先推薦歷史執行成功率高的方案類型
- 避免推薦歷史執行失敗的方案類型

---

## 📊 數據庫設計

### 用戶背景表（user_profiles）

```sql
CREATE TABLE user_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  -- 教育背景
  education_level VARCHAR(50),
  major_field VARCHAR(100),
  university VARCHAR(200),
  -- 文化背景
  ethnicity VARCHAR(100),
  cultural_identity TEXT[],
  upbringing_environment VARCHAR(50),
  -- 宗教背景
  religion VARCHAR(50),
  religious_practice_level VARCHAR(50),
  -- 家庭背景
  family_structure VARCHAR(50),
  parents_relationship VARCHAR(50),
  family_economic_status VARCHAR(50),
  -- 性格特質
  mbti_type VARCHAR(10),
  big_five_personality JSONB,
  communication_style VARCHAR(50),
  -- 其他
  occupation VARCHAR(100),
  interests TEXT[],
  core_values TEXT[],
  -- 隱私設置
  profile_visibility VARCHAR(20) DEFAULT 'private',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 關係檔案表（relationship_profiles）

```sql
CREATE TABLE relationship_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  pairing_id UUID NOT NULL REFERENCES pairings(id) ON DELETE CASCADE,
  -- 關係基本信息
  relationship_duration_days INTEGER,
  relationship_stage VARCHAR(50),
  milestones JSONB,
  -- 地理位置
  user1_location VARCHAR(200),
  user2_location VARCHAR(200),
  is_long_distance BOOLEAN DEFAULT false,
  distance_km INTEGER,
  meeting_frequency VARCHAR(50),
  -- 底線和雷點
  user1_bottom_lines TEXT[],
  user2_bottom_lines TEXT[],
  common_bottom_lines TEXT[],
  historical_red_flags JSONB,
  -- 喜好和偏好
  user1_preferences JSONB,
  user2_preferences JSONB,
  common_preferences JSONB,
  dislikes JSONB,
  -- 溝通模式
  communication_frequency VARCHAR(50),
  preferred_communication_methods TEXT[],
  conflict_communication_style VARCHAR(50),
  -- 關係優勢和挑戰
  relationship_strengths TEXT[],
  relationship_challenges TEXT[],
  -- 歷史記錄（自動生成）
  historical_case_types JSONB,
  historical_responsibility_trends JSONB,
  reconciliation_plan_execution_rate DECIMAL(5,2),
  relationship_improvement_trend VARCHAR(50),
  -- 元數據
  completion_percentage INTEGER DEFAULT 0,
  last_updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## 🎨 用戶界面設計

### 1. 背景設定界面

**引導式填寫**：
- 分步驟填寫，不強制一次性完成
- 每個步驟都有說明和示例
- 可隨時保存和繼續

**填寫步驟**：
1. 基本信息（必填）
2. 教育背景（可選）
3. 文化背景（可選）
4. 宗教背景（可選）
5. 家庭背景（可選）
6. 性格特質（可選，可通過測試）
7. 其他信息（可選）

**隱私設置**：
- 每個信息項都可以設置可見性（私密/僅配對對象/公開）
- 默認全部私密

### 2. 關係檔案界面

**協同填寫**：
- 某些信息需要雙方共同確認（如關係階段、共同底線）
- 某些信息可以各自填寫（如個人喜好）
- 雙方可以實時看到對方的填寫進度

**智能提取**：
- 從歷史案件中自動提取信息（如底線、雷點）
- 用戶確認後保存
- 可手動修改和補充

**完成度提示**：
- 顯示檔案完成度百分比
- 提示哪些信息還未填寫
- 鼓勵逐步完善

---

## 🔄 使用流程

### 1. 解鎖進階功能

1. 雙方都註冊帳號
2. 配對成功
3. 系統提示：「解鎖進階功能，獲得更個性化的判決和建議」
4. 引導填寫背景信息和關係檔案

### 2. 填寫背景信息

1. 進入「我的資料」頁面
2. 點擊「完善背景信息」
3. 分步驟填寫（可隨時保存和繼續）
4. 設置隱私可見性

### 3. 填寫關係檔案

1. 進入「關係檔案」頁面
2. 雙方協同填寫關係基本信息
3. 各自填寫個人喜好和底線
4. 確認共同底線和喜好
5. 系統自動提取歷史記錄

### 4. 使用進階功能

1. 提交案件時，系統自動使用背景信息和關係檔案
2. AI生成個性化判決（考慮背景和關係檔案）
3. 推薦精準和好方案（基於關係檔案）
4. 提供關係健康監測（基於歷史記錄）

---

## 📈 預期效果

### 1. 判決準確性提升

- 考慮文化背景和性格特質，判決更貼切
- 特別注意底線和雷點，避免觸及敏感問題
- 基於歷史記錄，確保判決一致性

### 2. 建議實用性提升

- 基於雙方的喜好，推薦更適合的活動
- 基於溝通模式，提供更貼切的溝通建議
- 基於地理位置，推薦適合當地的活動

### 3. 用戶體驗提升

- 個性化判決讓用戶感覺被理解和重視
- 精準和好方案提高執行成功率
- 關係健康監測幫助預防衝突

---

## ⚠️ 注意事項

### 1. 隱私保護

- 所有背景信息和關係檔案默認為私密
- 用戶可選擇是否與配對對象共享
- 信息僅用於AI分析，不會在判決書中直接顯示

### 2. 數據安全

- 加密存儲敏感信息
- 定期備份數據
- 用戶可隨時刪除數據

### 3. 可選性

- 所有背景信息和關係檔案都是可選的
- 不填寫也能正常使用，只是判決和建議會更通用
- 鼓勵逐步完善，不強制一次性完成

---

**最後更新**：2024年  
**功能版本**：v1.0（進階功能設計）

